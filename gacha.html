<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê½ ì—†ëŠ” ë½‘ê¸° ê¸°ê³„</title>
    <style>
       /* 1. ìƒˆë¡œ ì—…ë¡œë“œí•œ í°íŠ¸ íŒŒì¼ì„ ì§ì ‘ ë“±ë¡ */
        @font-face {
            font-family: 'modu'; /* ì•ìœ¼ë¡œ ì´ í°íŠ¸ë¥¼ ë¶€ë¥¼ ì´ë¦„ */
            src: url('fonts/modu.woff') format('woff'); /* í°íŠ¸ íŒŒì¼ ê²½ë¡œ */
        }
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* 2. í˜ì´ì§€ì˜ ê¸°ë³¸ í°íŠ¸ë¥¼ 'modu'ë¡œ ë³€ê²½ */
            font-family: 'modu', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ: ë°°ê²½ ì´ë¯¸ì§€ ì ìš© */
        .gacha-container {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-image: url('https://github.com/jungsan21-dot/v480/blob/111ee436c24c12faf10e665e2530e7d6d7142e22/images/gachaback.png?raw=true');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        /* ë²„íŠ¼ì„ ë‹´ëŠ” ì»¨í…Œì´ë„ˆ ìœ„ì¹˜ ì¡°ì • */
        .controls {
            position: absolute;
            bottom: 10%;
            width: 100%;
            height: 80px; /* ë²„íŠ¼ ë†’ì´ë¥¼ ê³ ë ¤í•œ ê³µê°„ í™•ë³´ */
        }

        .gacha-button {
            /* âœ¨ ë²„íŠ¼ì— í°íŠ¸ ì ìš© */
            font-family: 'modu', sans-serif;
            font-weight: 700;
            color: #fff;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all .2s;
            box-shadow: 0 6px 8px rgba(0, 0, 0, .2);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            position: absolute; /* ê°œë³„ ìœ„ì¹˜ ì§€ì •ì„ ìœ„í•´ absolute ì‚¬ìš© */
        }
        .gacha-button:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02); /* í™•ëŒ€ íš¨ê³¼ ì¶”ê°€ */
            box-shadow: 0 8px 12px rgba(0, 0, 0, .3);
        }
        .gacha-button:disabled {
            background-color: #9ca3af !important;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* ë½‘ê¸° ë²„íŠ¼: í¬ê¸° í‚¤ìš°ê³  ì¤‘ì•™ ì •ë ¬ */
        #gacha-button { 
            background-color: #d9534f;
            padding: 2vh 5vw;
            font-size: clamp(2em, 5vh, 3.5em);
            left: 50%;
            bottom: 0;
            transform: translateX(-50%); /* ì •í™•í•œ ì¤‘ì•™ ì •ë ¬ */
        }
        
        /* ì„ ë¬¼ í¸ì§‘ ë²„íŠ¼: í¬ê¸° ì¤„ì´ê³  ìš°ì¸¡ í•˜ë‹¨ìœ¼ë¡œ ì´ë™ */
        #edit-prizes-button { 
            background-color: #f0ad4e;
            padding: 1vh 2vw;
            font-size: clamp(0.8em, 1.8vh, 1em);
            right: 30px;
            bottom: 0;
        }

        /* ë½‘ê¸° ê³µ ìŠ¤íƒ€ì¼ ê°œì„  */
        #gacha-ball {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: clamp(180px, 36vmin, 360px); 
            height: clamp(180px, 36vmin, 360px);
            border-radius: 50%;
            box-shadow: 0 8px 20px rgba(0, 0, 0, .3);
            display: none;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-weight: 700;
            padding: 20px;
            box-sizing: border-box;
            cursor: pointer;
            z-index: 100;
            border: 6px solid #A52A2A; /* ì§„í•œ ê°ˆìƒ‰ í…Œë‘ë¦¬ */
            flex-direction: column;
        }
        
        /* ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .prize-icon {
            font-size: clamp(1.5em, 6vmin, 3em);
            line-height: 1;
        }
        
        /* ë½‘ê¸° ê³µ ë‚´ë¶€ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ê°œì„  */
        #gacha-ball p {
            margin: 10px 0;
            font-size: clamp(1.32em, 5.5vmin, 2.75em); 
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
            word-break: keep-all;
        }

        @keyframes fall-and-reveal {
            0% { top: 20%; transform: translate(-50%, -50%) scale(.1); opacity: 0; }
            50% { top: 60%; transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
            100% { top: 50%; transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        .animate-ball {
            animation: fall-and-reveal 3s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        }

        @keyframes fadeInContent {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .prize-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeInContent 1s ease-out forwards;
        }

        /* í¸ì§‘ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #edit-prizes-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, .6); z-index: 2000; justify-content: center; align-items: center; }
        #edit-prizes-modal .modal-content { background: #fff; padding: 25px; border-radius: 15px; width: 90%; max-width: 600px; text-align: left; max-height: 85vh; display: flex; flex-direction: column; }
        #edit-prizes-modal h2 { margin-top: 0; }
        #prize-list { overflow-y: auto; flex-grow: 1; border: 1px solid #ccc; border-radius: 8px; margin: 10px 0; }
        .prize-item { display: flex; gap: 10px; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .prize-item input {
            /* âœ¨ ì…ë ¥ì°½ì— í°íŠ¸ ì ìš© */
            font-family: 'modu', sans-serif;
            padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px;
        }
        .prize-item input[type=text] { flex-grow: 1; }
        .prize-item input[type=number] { width: 80px; text-align: center; }
        .delete-prize-btn { background-color: #e53e3e; color: #fff; border: none; border-radius: 50%; width: 30px; height: 30px; font-weight: 700; cursor: pointer; flex-shrink: 0; }
        .modal-buttons { margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }
        .modal-buttons button {
            /* âœ¨ ëª¨ë‹¬ ì•ˆ ë²„íŠ¼ì— í°íŠ¸ ì ìš© */
            font-family: 'modu', sans-serif;
            padding: 10px 20px; border-radius: 8px; border: none; color: #fff; cursor: pointer; font-weight: bold;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.58/build/Tone.js"></script>
</head>
<body>
    <div class="gacha-container">
        
        <div class="controls">
            <button id="gacha-button" class="gacha-button">ë½‘ê¸°!</button>
            <button id="edit-prizes-button" class="gacha-button">ì„ ë¬¼ í¸ì§‘</button>
        </div>
        
        <div id="gacha-ball"></div>
    </div>

    <div id="edit-prizes-modal">
        <div class="modal-content">
            <h2>ì„ ë¬¼ ëª©ë¡ í¸ì§‘</h2>
            <div id="prize-list"></div>
            <div class="modal-buttons">
                <button id="add-prize-button" style="background-color:#3182ce">ì„ ë¬¼ ì¶”ê°€</button>
                <button id="save-prizes-button" style="background-color:#5cb85c">ì €ì¥</button>
                <button id="close-prizes-modal-button" style="background-color:#aaa">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
    <script>
        let items = [];
        const defaultItems = [
            { name: 'ë¹„ìµ¸ë¹„ 2ê°œ', quantity: 15 },
            { name: 'ê³ ì˜¤ê¸‰ ìƒ¤í”„', quantity: 10 }, 
            { name: 'ìƒˆì½¤ë‹¬ì½¤', quantity: 10 },
            { name: 'ë¹¼ë¹¼ë¡œ', quantity: 10 }, 
            { name: 'ì¹´í”¼ë°”ë¼ í‚¤ë§', quantity: 10 },
            { name: 'ê³ ì˜¤ê¸‰ ë³¼íœ', quantity: 5 },
            { name: 'ì•„ë¬´ê±°ë‚˜', quantity: 5 }
        ];
        
        const ballColors = ['#ff5662', '#ffb833', '#40b5a7', '#3d6170', '#c0f2f4'];
        
        const synth = new Tone.NoiseSynth({ noise: { type: "brown" }, envelope: { attack: .02, decay: .2, sustain: .05 } }).toDestination();
        
        const ball = document.getElementById('gacha-ball');
        const button = document.getElementById('gacha-button');
        const editPrizesModal = document.getElementById('edit-prizes-modal');
        const prizeListContainer = document.getElementById('prize-list');
        let isAnimating = false;

        function getContrastColor(hex) {
            if (!hex) return 'black';
            hex = hex.replace('#', '');
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return (yiq >= 128) ? 'black' : 'white';
        }

        function loadItems() {
            const savedItems = localStorage.getItem('gachaItems');
            items = savedItems ? JSON.parse(savedItems) : JSON.parse(JSON.stringify(defaultItems));
        }

        function saveItems() {
            localStorage.setItem('gachaItems', JSON.stringify(items));
        }

        function checkGachaAvailability() {
            const totalQuantity = items.reduce((sum, item) => sum + (item.quantity || 0), 0);
            button.disabled = totalQuantity === 0;
            button.textContent = totalQuantity === 0 ? 'ì„ ë¬¼ ì—†ìŒ' : 'ë½‘ê¸°!';
        }

        async function drawItem() {
            if (isAnimating || items.reduce((sum, item) => sum + item.quantity, 0) === 0) return;
            isAnimating = true;
            button.disabled = true;

            await Tone.start();
            synth.triggerAttackRelease("3s");
            
            const prizePool = [];
            items.forEach(item => {
                for (let i = 0; i < item.quantity; i++) { prizePool.push(item.name); }
            });
            if (prizePool.length === 0) { isAnimating = false; checkGachaAvailability(); return; }
            const selectedItemName = prizePool[Math.floor(Math.random() * prizePool.length)];
            const selectedItem = items.find(item => item.name === selectedItemName);

            ball.style.backgroundColor = ballColors[Math.floor(Math.random() * ballColors.length)];
            ball.innerHTML = '';
            ball.style.display = 'flex';
            ball.classList.remove('animate-ball');
            void ball.offsetWidth;
            ball.classList.add('animate-ball');

            setTimeout(() => {
                if (selectedItem) {
                    selectedItem.quantity--;
                    saveItems();
                }
                ball.innerHTML = `
                    <div class="prize-content">
                        <span class="prize-icon">ğŸ</span>
                        <p>${selectedItemName}</p>
                        <span class="prize-icon">ğŸ‰</span>
                    </div>
                `;
                const textColor = getContrastColor(ball.style.backgroundColor);
                ball.querySelector('.prize-content').style.color = textColor;
                setTimeout(() => {
                    isAnimating = false;
                    checkGachaAvailability();
                }, 1500);
            }, 3000);
        }
        
        function renderPrizeEditor() {
            prizeListContainer.innerHTML = '';
            items.forEach((item, index) => {
                addPrizeRow(item, index);
            });
        }
        
        function addPrizeRow(item = { name: '', quantity: 1 }, index = -1) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'prize-item';
            itemDiv.innerHTML = `
                <input type="text" class="prize-name" value="${item.name}" placeholder="ì„ ë¬¼ ì´ë¦„">
                <input type="number" class="prize-quantity" value="${item.quantity}" min="0" placeholder="ìˆ˜ëŸ‰">
                <button class="delete-prize-btn">X</button>
            `;
            prizeListContainer.appendChild(itemDiv);
            itemDiv.querySelector('.delete-prize-btn').addEventListener('click', (e) => {
                e.target.closest('.prize-item').remove();
            });
        }
        
        document.getElementById('edit-prizes-button').addEventListener('click', () => {
            renderPrizeEditor();
            editPrizesModal.style.display = 'flex';
        });

        document.getElementById('add-prize-button').addEventListener('click', () => {
            addPrizeRow();
        });

        document.getElementById('save-prizes-button').addEventListener('click', () => {
            const newItems = [];
            prizeListContainer.querySelectorAll('.prize-item').forEach(el => {
                const name = el.querySelector('.prize-name').value.trim();
                const quantity = parseInt(el.querySelector('.prize-quantity').value, 10);
                if (name && !isNaN(quantity)) {
                    newItems.push({ name, quantity });
                }
            });
            if (newItems.length > 0) {
                items = newItems;
                saveItems();
                alert('ì„ ë¬¼ ëª©ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                editPrizesModal.style.display = 'none';
                checkGachaAvailability();
            } else {
                alert('ìœ íš¨í•œ ì„ ë¬¼ì´ í•˜ë‚˜ ì´ìƒ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.');
            }
        });

        document.getElementById('close-prizes-modal-button').addEventListener('click', () => {
            editPrizesModal.style.display = 'none';
        });

        button.addEventListener('click', drawItem);
        ball.addEventListener('click', () => {
            if (!isAnimating) {
                ball.style.display = 'none';
            }
        });

        loadItems();
        checkGachaAvailability();
    </script>
</body>
</html>



